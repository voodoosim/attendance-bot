# 📋 출석 봇 요구사항 명세서

> **작성일**: 2025-11-09
> **버전**: 1.0.0
> **프로젝트**: Attendance Bot (출석 & 채팅 활동 보상 봇)

---

## 🎯 프로젝트 개요

텔레그램 그룹에서 채팅 활동에 대한 보상을 제공하는 게이미피케이션 봇.
출석 체크로 유저를 등록하고, 채팅 활동에 따라 랜덤 점수와 잭팟 배율을 제공합니다.

---

## 🔑 핵심 기능

### 1. 출석 체크 시스템 (`.출첵`)

**목적**: 유저 등록 및 일일 출석 점수 부여

**동작**:
1. 첫 사용 시: 유저 데이터 생성 (DB 등록)
2. 이후 사용: 출석 체크 기록
3. 출석 점수 부여

**출석 점수**:
- 기본 출석 점수: **10점**
- 연속 출석 보너스: 연속 N일 시 +N점 (최대 +7점)

**제약**:
- 1일 1회만 가능
- 자정(00:00) 기준 초기화

**응답 예시**:
```
✅ 출석 체크 완료!
📅 연속 출석: 3일
🎁 획득 점수: 13점 (기본 10 + 보너스 3)
💰 총 점수: 1,234점
💬 총 채팅 수: 567개
```

---

### 2. 채팅 활동 보상 시스템

**목적**: 채팅 활동에 대한 랜덤 보상 제공

**동작**:
1. 등록된 유저의 메시지 감지
2. 랜덤 점수 생성 (1~6)
3. 잭팟 확률 체크
4. 잭팟 발동 시 배율 적용
5. 점수 및 채팅 수 카운팅

**점수 계산**:
```python
base_score = random.randint(1, 6)  # 기본 점수: 1~6

if is_jackpot:  # 잭팟 확률: 5%
    multiplier = random.randint(1, 7)  # 배율: 1~7배
    final_score = base_score * multiplier
else:
    final_score = base_score
```

**잭팟 설정**:
- 발동 확률: **5% (1/20)**
- 배율 범위: **1~7배**
- 평균 배율: **4배**

**제약**:
- `.출첵`으로 등록된 유저만 카운팅
- 미등록 유저의 메시지는 무시
- 봇 명령어 메시지는 카운팅 제외

**잭팟 응답 예시**:
```
🎰 잭팟!! 🎰
기본 점수: 5점
배율: x7
획득 점수: 35점!
💰 총 점수: 1,269점
```

**일반 응답**:
- 조용히 점수만 적립 (메시지 없음)
- 또는 10점마다 알림 (선택)

---

### 3. 정보 조회 시스템

#### 3.1 내 정보 (`.내정보` 또는 `/내정보`)

**응답 예시**:
```
👤 사용자 정보

📅 연속 출석: 5일
🎁 총 출석: 30일

💰 총 점수: 1,234점
💬 총 채팅 수: 567개
📊 평균 점수/채팅: 2.17점

🎰 잭팟 횟수: 3회
🔥 최고 잭팟: 42점 (6 x 7배)
```

#### 3.2 랭킹 (`.랭킹` 또는 `/랭킹`)

**점수 랭킹**:
```
🏆 점수 랭킹 TOP 10

1. 👑 @user1 - 5,432점 (789 메시지)
2. 🥈 @user2 - 4,321점 (654 메시지)
3. 🥉 @user3 - 3,210점 (543 메시지)
4. @user4 - 2,109점 (432 메시지)
...
```

**채팅 랭킹**:
```
💬 채팅 랭킹 TOP 10

1. 👑 @user1 - 999 메시지 (5,432점)
2. 🥈 @user2 - 888 메시지 (4,321점)
...
```

---

### 4. 관리자 기능 (예정)

- `/admin` - 관리자 메뉴
- `/reset_user [user_id]` - 유저 데이터 초기화
- `/add_score [user_id] [score]` - 점수 직접 부여
- `/config` - 점수 설정 변경 (기본점수, 잭팟확률 등)

---

## 📊 데이터 모델

### User (유저)
```python
- id: int (PK)
- telegram_id: int (Unique)
- username: str
- total_score: int (총 점수)
- chat_count: int (총 채팅 수)
- jackpot_count: int (잭팟 횟수)
- max_jackpot: int (최고 잭팟)
- consecutive_days: int (연속 출석)
- total_attendance: int (총 출석)
- last_checkin: datetime (마지막 출석)
- created_at: datetime
- updated_at: datetime
```

### Attendance (출석 기록)
```python
- id: int (PK)
- user_id: int (FK)
- date: date (출석 날짜)
- score: int (획득 점수)
- consecutive_days: int (당시 연속일)
- created_at: datetime
```

### ChatActivity (채팅 활동)
```python
- id: int (PK)
- user_id: int (FK)
- message_id: int
- base_score: int (기본 점수 1~6)
- is_jackpot: bool (잭팟 여부)
- multiplier: int (배율, 기본 1)
- final_score: int (최종 점수)
- created_at: datetime
```

### ScoreConfig (점수 설정)
```python
- id: int (PK)
- attendance_score: int (기본 출석 점수, 기본 10)
- chat_score_min: int (채팅 점수 최소, 기본 1)
- chat_score_max: int (채팅 점수 최대, 기본 6)
- jackpot_chance: float (잭팟 확률, 기본 0.05 = 5%)
- multiplier_min: int (배율 최소, 기본 1)
- multiplier_max: int (배율 최대, 기본 7)
- max_consecutive_bonus: int (최대 연속 보너스, 기본 7)
- updated_at: datetime
```

---

## 🎮 사용 시나리오

### 시나리오 1: 신규 유저 등록
```
1. 유저: .출첵
2. 봇: [유저 데이터 생성]
3. 봇: ✅ 출석 체크 완료!
       📅 연속 출석: 1일
       🎁 획득 점수: 11점 (기본 10 + 보너스 1)
       💰 총 점수: 11점
       💬 총 채팅 수: 0개
```

### 시나리오 2: 일반 채팅
```
1. 유저: "안녕하세요!"
2. 봇: [조용히 점수 적립]
   - base_score = 3
   - is_jackpot = False
   - final_score = 3
   - chat_count += 1
   - total_score += 3
```

### 시나리오 3: 잭팟 발동
```
1. 유저: "오늘 날씨 좋네요"
2. 봇: 🎰 잭팟!! 🎰
       기본 점수: 5점
       배율: x6
       획득 점수: 30점!
       💰 총 점수: 1,100점
```

### 시나리오 4: 미등록 유저
```
1. 유저: "안녕하세요" (출첵 안 한 유저)
2. 봇: [무시 - 아무 동작 안 함]
```

---

## ⚙️ 설정값

| 항목 | 기본값 | 설명 |
|------|--------|------|
| 출석 점수 | 10점 | 기본 출석 점수 |
| 연속 보너스 | +1~7점 | 연속 출석일 × 1점 |
| 채팅 점수 범위 | 1~6점 | 랜덤 기본 점수 |
| 잭팟 확률 | 5% | 1/20 확률 |
| 잭팟 배율 | 1~7배 | 랜덤 배율 |
| 메시지 알림 | 잭팟만 | 일반 메시지는 조용히 |

---

## 🚫 제약사항

1. **등록 필수**: `.출첵`으로 등록하지 않으면 점수 적립 불가
2. **1일 1출석**: 자정 기준 1일 1회만 출석 가능
3. **명령어 제외**: 봇 명령어 메시지는 채팅 카운팅 제외
4. **그룹 전용**: 개인 채팅에서는 작동 안 함 (선택)

---

## 📈 향후 확장 기능

- [ ] 레벨 시스템 (점수 기반)
- [ ] 업적/배지 시스템
- [ ] 아이템 상점 (점수로 아이템 구매)
- [ ] 일일 미션 시스템
- [ ] 점수 교환 기능
- [ ] 그룹별 독립 랭킹
- [ ] 시즌/리그 시스템

---

**작성자**: Sasori
**승인 상태**: ✅ 승인됨
**다음 단계**: 설계 및 구현
